<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPAT - 프록시 모니터링 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div id="app">
        <!-- 네비게이션 -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#">
                    PPAT
                </a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link px-3" href="#" onclick="showTab('resources')">
                        자원사용률
                    </a>
                    <a class="nav-link px-3" href="#" onclick="showTab('sessions')">
                        세션브라우저
                    </a>
                    <a class="nav-link px-3" href="#" onclick="alert('개발 예정')">
                        정책조회
                    </a>
                    <a class="nav-link px-3" href="#" onclick="showTab('management')">
                        관리
                    </a>
                </div>
            </div>
        </nav>

        <!-- 알림 영역 -->
        <div id="notifications" class="container mt-3"></div>

        <!-- 메인 컨텐츠 -->
        <div class="container mt-4">
            <!-- 관리 탭 -->
            <div id="managementTab">
                <!-- 프록시 그룹 관리 섹션 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 text-muted">프록시 그룹</h5>
                                <button class="btn btn-primary btn-sm" onclick="showGroupModal()">
                                    그룹 추가
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0 ps-3">그룹명</th>
                                                <th class="border-0">설명</th>
                                                <th class="border-0">프록시 수</th>
                                                <th class="border-0">메인 서버</th>
                                                <th class="border-0 text-center">작업</th>
                                            </tr>
                                        </thead>
                                        <tbody id="groupTableBody">
                                            <!-- 그룹 목록이 여기에 동적으로 로드됩니다 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 프록시 서버 관리 섹션 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 text-muted">프록시 서버</h5>
                                <button class="btn btn-primary btn-sm" onclick="showModal()">
                                    프록시 추가
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0 ps-3">이름</th>
                                                <th class="border-0">IP 주소</th>
                                                <th class="border-0">그룹</th>
                                                <th class="border-0">역할</th>
                                                <th class="border-0">상태</th>
                                                <th class="border-0 text-center">작업</th>
                                            </tr>
                                        </thead>
                                        <tbody id="proxyTableBody">
                                            <!-- 프록시 목록이 여기에 동적으로 로드됩니다 -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 빈 상태 메시지 -->
                                <div id="emptyMessage" class="text-center py-5" style="display: none;">
                                    <div class="text-muted mb-3">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M4,6V8H6V6H4M6,10V12H4V10H6M6,14V16H4V14H6M6,18V20H4V18H6M8,6V8H10V6H8M10,10V12H8V10H10M8,14V16H10V14H8M8,18V20H10V18H8M12,6V8H14V6H12M14,10V12H12V10H14M12,14V16H14V14H12M12,18V20H14V18H12M16,6V8H18V6H16M18,10V12H16V10H18M16,14V16H18V14H16M16,18V20H18V18H16M20,6V8H22V6H20M22,10V12H20V10H22M20,14V16H22V14H20M20,18V20H22V18H20Z"/>
                                        </svg>
                                    </div>
                                    <h6 class="text-muted">등록된 프록시 서버가 없습니다</h6>
                                    <p class="text-muted small">첫 번째 프록시 서버를 추가해보세요.</p>
                                    <button class="btn btn-primary btn-sm" onclick="showModal()">
                                        프록시 추가
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 모니터링 설정 관리 섹션 -->
                <div class="row">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 text-muted">모니터링 설정 관리</h5>
                                <button class="btn btn-primary btn-sm" onclick="saveMonitoringConfig()">저장</button>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label small">세션 명령어 (session_cmd)</label>
                                        <textarea id="configSessionCmd" class="form-control" rows="4" placeholder="세션 조회 명령어"></textarea>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small">SNMP OID 설정 (JSON)</label>
                                        <textarea id="configSnmpOids" class="form-control" rows="4" placeholder='{"CPU":"...","Memory":"..."}'></textarea>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">CPU 임계치 (%)</label>
                                        <input id="configCpuThreshold" type="number" class="form-control" min="0" max="100" value="80">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">메모리 임계치 (%)</label>
                                        <input id="configMemoryThreshold" type="number" class="form-control" min="0" max="100" value="80">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">기본 주기 (초)</label>
                                        <input id="configDefaultInterval" type="number" class="form-control" min="5" step="5" value="30">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-outline-secondary w-100" onclick="loadMonitoringConfig()">설정 새로고침</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 자원사용률 탭 -->
            <div id="resourcesTab" style="display: none;">
                <!-- 요약 통계 -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-primary" id="totalProxiesCount">0</h5>
                                <p class="card-text small text-muted">전체 프록시</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-success" id="activeProxiesCount">0</h5>
                                <p class="card-text small text-muted">온라인</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-secondary" id="offlineProxiesCount">0</h5>
                                <p class="card-text small text-muted">오프라인</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-secondary" id="resourcesGroupLabel">그룹 선택</h5>
                                <select id="resourcesGroupSelect" class="form-select form-select-sm"></select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 모니터링 설정 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-muted">모니터링 설정</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge" id="monitoringStatus">정지됨</span>
                                    <button class="btn btn-sm btn-success" id="startMonitoringBtn" onclick="startMonitoring()">시작</button>
                                    <button class="btn btn-sm btn-danger" id="stopMonitoringBtn" onclick="stopMonitoring()" disabled>중지</button>
                                    <button class="btn btn-sm btn-outline-primary" id="manualRefreshBtn" onclick="refreshResources()" disabled>수동 새로고침</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <label for="monitoringInterval" class="form-label small">갱신 주기 (초)</label>
                                        <select class="form-select form-select-sm" id="monitoringInterval" onchange="updateMonitoringInterval()">
                                            <option value="10">10초</option>
                                            <option value="30" selected>30초</option>
                                            <option value="60">1분</option>
                                            <option value="300">5분</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            마지막 업데이트: <span id="lastUpdate">-</span> | 
                                            다음 업데이트: <span id="nextUpdate">-</span>
                                        </small>
                                    </div>
                                    <div class="col-md-3 text-end">
                                        <small class="text-muted">
                                            수집된 항목: <span class="badge bg-light text-dark" id="collectedItemsCount">8</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 리소스 모니터링 테이블 -->
                <div class="row">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-muted">실시간 자원사용률</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0 ps-3">프록시</th>
                                                <th class="border-0">그룹</th>
                                                <th class="border-0">역할</th>
                                                <th class="border-0">CPU</th>
                                                <th class="border-0">메모리</th>
                                                <th class="border-0">고유클라이언트</th>
                                                <th class="border-0">CC</th>
                                                <th class="border-0">CS</th>
                                                <th class="border-0">HTTP</th>
                                                <th class="border-0">HTTPS</th>
                                                <th class="border-0">FTP</th>
                                                <th class="border-0">상태</th>
                                                <th class="border-0">업데이트</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resourcesTableBody">
                                            <!-- 리소스 데이터가 여기에 동적으로 로드됩니다 -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 빈 상태 메시지 -->
                                <div id="resourcesEmptyMessage" class="text-center py-5" style="display: none;">
                                    <div class="text-muted mb-3">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,13H17V11H7"/>
                                        </svg>
                                    </div>
                                    <h6 class="text-muted">활성화된 프록시가 없습니다</h6>
                                    <p class="text-muted small">프록시를 활성화하여 모니터링을 시작하세요.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 세션브라우저 탭 -->
            <div id="sessionsTab" style="display: none;">
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 text-muted">세션 브라우저</h5>
                                <div class="d-flex gap-2 align-items-center">
                                    <select id="sessionGroupSelect" class="form-select form-select-sm" style="min-width: 200px;"></select>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="collectSessionsByGroup()">그룹 수집</button>
                                    <input id="sessionSearchInput" type="text" class="form-control form-control-sm" placeholder="IP, User, Policy 검색" style="min-width: 220px;">
                                    <button class="btn btn-sm btn-primary" onclick="searchSessions()">검색</button>
                                    <select id="sessionProxySelect" class="form-select form-select-sm" style="min-width: 220px;"></select>
                                    <button class="btn btn-sm btn-outline-primary" onclick="loadSessions()">프록시별 조회</button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0 ps-3">Proxy</th>
                                                <th class="border-0">Transaction</th>
                                                <th class="border-0">Creation Time</th>
                                                <th class="border-0">Protocol</th>
                                                <th class="border-0">Cust ID</th>
                                                <th class="border-0">User Name</th>
                                                <th class="border-0">Client IP</th>
                                                <th class="border-0">Server IP</th>
                                                <th class="border-0">URL</th>
                                                <th class="border-0">Age(seconds) Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sessionsTableBody"></tbody>
                                    </table>
                                </div>
                                <div id="sessionsEmptyMessage" class="text-center py-5" style="display:none;">
                                    <h6 class="text-muted">세션 데이터가 없습니다</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 프록시 그룹 모달 -->
    <div class="modal fade" id="groupModal" tabindex="-1" aria-labelledby="groupModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="groupModalTitle">프록시 그룹 추가</h5>
                    <button type="button" class="btn-close" onclick="closeGroupModal()"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="groupName" class="form-label">그룹명 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="groupName" placeholder="예: 서울 센터" required>
                        </div>
                        <div class="mb-3">
                            <label for="groupDescription" class="form-label">설명</label>
                            <textarea class="form-control" id="groupDescription" rows="2" placeholder="그룹에 대한 설명을 입력하세요"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" onclick="closeGroupModal()">취소</button>
                    <button type="button" class="btn btn-primary" id="saveGroupButton" onclick="saveGroup()">
                        저장
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 프록시 서버 모달 -->
    <div class="modal fade" id="proxyModal" tabindex="-1" aria-labelledby="proxyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="modalTitle">프록시 추가</h5>
                    <button type="button" class="btn-close" onclick="closeModal()"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="proxyName" class="form-label">이름 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="proxyName" placeholder="예: Seoul Main Proxy" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="proxyHost" class="form-label">IP 주소 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="proxyHost" placeholder="예: 192.168.1.100" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxySshPort" class="form-label">SSH 포트</label>
                                    <input type="number" class="form-control" id="proxySshPort" value="22" min="1" max="65535">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxySnmpPort" class="form-label">SNMP 포트</label>
                                    <input type="number" class="form-control" id="proxySnmpPort" value="161" min="1" max="65535">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxyUsername" class="form-label">사용자명</label>
                                    <input type="text" class="form-control" id="proxyUsername" value="root">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxySnmpVersion" class="form-label">SNMP 버전</label>
                                    <select class="form-select" id="proxySnmpVersion">
                                        <option value="v2c" selected>SNMP v2c</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxySnmpCommunity" class="form-label">커뮤니티 스트링</label>
                                    <input type="text" class="form-control" id="proxySnmpCommunity" value="public" placeholder="예: public">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="proxyGroup" class="form-label">그룹</label>
                                    <select class="form-select" id="proxyGroup">
                                        <option value="">그룹을 선택하세요</option>
                                        <!-- 그룹 옵션들이 동적으로 로드됩니다 -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="proxyPassword" class="form-label">비밀번호</label>
                                    <input type="password" class="form-control" id="proxyPassword" placeholder="SSH 비밀번호">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <!-- 빈 공간 -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="proxyDescription" class="form-label">설명</label>
                            <textarea class="form-control" id="proxyDescription" rows="2" placeholder="프록시 서버에 대한 설명을 입력하세요"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="proxyIsActive">
                                    <label class="form-check-label" for="proxyIsActive">
                                        활성화 상태로 시작
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="proxyIsMain">
                                    <label class="form-check-label" for="proxyIsMain">
                                        메인 클러스터로 지정
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" onclick="closeModal()">취소</button>
                    <button type="button" class="btn btn-primary" id="saveButton" onclick="saveProxy()">
                        저장
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 애플리케이션 스크립트 -->
    <script src="/static/js/app.js"></script>
</body>
</html>